apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Step 04: Model Registry & Governance
# Centralized model versioning, metadata management, and lifecycle tracking
#
# Architecture:
#   ┌─────────────────┐         ┌─────────────────┐         ┌─────────────┐
#   │   Workbench     │────────▶│  Model Registry │────────▶│   KServe    │
#   │  (Train/Export) │         │                 │         │  (Deploy)   │
#   └─────────────────┘         │  ┌───────────┐  │         └─────────────┘
#                               │  │  MariaDB  │  │
#                               │  │ (Metadata)│  │
#                               │  └───────────┘  │
#                               └─────────────────┘
#                                       │
#                                       ▼
#                               ┌─────────────────┐
#                               │     MinIO       │
#                               │  (Artifacts)    │
#                               └─────────────────┘
#
# Namespaces:
#   - private-ai: MariaDB database
#   - rhoai-model-registries: ModelRegistry instance, RBAC
#
# Ref: https://docs.redhat.com/en/documentation/red_hat_openshift_ai_self-managed/3.0/html-single/managing_model_registries/index

resources:
  # ═══════════════════════════════════════════════════════════════════════════
  # 1. Metadata Database in private-ai namespace (sync-wave: 1-2)
  # ═══════════════════════════════════════════════════════════════════════════
  # MariaDB stores model versions, metadata, and lineage
  - database/
  
  # ═══════════════════════════════════════════════════════════════════════════
  # 2. Model Registry Instance in rhoai-model-registries (sync-wave: 3-5)
  # ═══════════════════════════════════════════════════════════════════════════
  # ModelRegistry CR - operator manages the namespace
  - registry/
  
  # ═══════════════════════════════════════════════════════════════════════════
  # 3. RBAC in rhoai-model-registries (sync-wave: 10)
  # ═══════════════════════════════════════════════════════════════════════════
  # ai-developer: register/deploy models
  # ai-admin: full access including archive/delete
  - rbac/
  
  # ═══════════════════════════════════════════════════════════════════════════
  # 4. Seed Job (sync-wave: 15)
  # ═══════════════════════════════════════════════════════════════════════════
  # Pre-populate registry with demo model (Granite-7b-Inference)
  - seed-job.yaml

# ═══════════════════════════════════════════════════════════════════════════════
# Notes
# ═══════════════════════════════════════════════════════════════════════════════
#
# Two namespaces are used:
# 1. private-ai: MariaDB database (our managed infrastructure)
# 2. rhoai-model-registries: ModelRegistry instances (operator-managed)
#
# Prerequisites:
# - Step 03 completed (MinIO for artifact storage)
# - Model Registry component enabled in DSC (done in Step 02)
#
# Dashboard Integration:
# - ModelRegistry appears in Settings → Model registries
# - Registered models appear in Model Catalog (AI Available Assets)
# - "Deploy" button uses Hardware Profiles from Step 02
