apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# =============================================================================
# Model Upload Jobs - Enterprise Portfolio
# =============================================================================
# These jobs download Red Hat Validated models from HuggingFace and upload
# to MinIO for KServe storage-initializer to stream at pod startup.
#
# S3 Storage Strategy (Official RHOAI 3.0 Recommendation):
#   - Avoids CRI-O overlay extraction failures for large images
#   - KServe storage-initializer streams directly to ephemeral storage
#   - 300GB EBS nodes can handle 50GB+ model weights
#
# ArgoCD Sync Behavior:
#   - Jobs use sync-wave: 1 to run BEFORE InferenceServices
#   - Jobs are idempotent - they skip if model already exists in MinIO
#   - PVCs persist to avoid re-downloading on subsequent syncs
#
# Prerequisites:
#   - HF token (optional for public models): 
#     oc create secret generic hf-token -n minio-storage --from-literal=token=hf_xxx
# =============================================================================

resources:
  # BF16 Models (Full Precision, Multi-GPU)
  - upload-mistral-bf16.yaml      # Mistral-Small-24B BF16 (~48GB, 4-GPU)
  - upload-gpt-oss-20b.yaml       # GPT-OSS-20B BF16 (~44GB, 4-GPU)
  
  # FP8 Models (Quantized, Single-GPU)
  - upload-granite-8b.yaml        # Granite-3.1-8B-Instruct-FP8 (~8GB, 1-GPU)
