# Grafana Datasource Configuration
# ============================================================================
# Configures Prometheus datasource pointing to OpenShift Thanos Querier.
# Uses Bearer token authentication from the ServiceAccount token.
#
# Grafana 9+ supports reading tokens from files via 'tokenFile' in jsonData.
# The SA token is automatically mounted at /var/run/secrets/kubernetes.io/serviceaccount/token
#
# Ref: https://grafana.com/docs/grafana/latest/datasources/prometheus/
# Ref: https://ai-on-openshift.io/odh-rhoai/kserve-uwm-dashboard-metrics/
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
  namespace: private-ai
  labels:
    app: grafana
    app.kubernetes.io/part-of: step-07-model-performance-metrics
  annotations:
    argocd.argoproj.io/sync-wave: "2"
data:
  datasources.yaml: |
    apiVersion: 1
    datasources:
      # User Workload Monitoring Thanos Querier
      - name: Prometheus-UWM
        type: prometheus
        access: proxy
        # Thanos Querier in openshift-monitoring namespace
        url: https://thanos-querier.openshift-monitoring.svc.cluster.local:9091
        isDefault: true
        editable: false
        jsonData:
          # TLS configuration for internal cluster communication
          tlsSkipVerify: true
          timeInterval: "5s"
          # Use Bearer token authentication
          httpMethod: POST
          # Read token from ServiceAccount mount
          httpHeaderName1: "Authorization"
        secureJsonData:
          # Token placeholder - will be replaced by init container
          httpHeaderValue1: "Bearer PLACEHOLDER"

