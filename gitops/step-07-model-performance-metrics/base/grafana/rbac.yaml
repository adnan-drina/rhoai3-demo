# Grafana RBAC - ServiceAccount with Monitoring Access
# ============================================================================
# Creates a ServiceAccount that can read metrics from the OpenShift
# User Workload Monitoring Thanos Querier.
#
# The cluster-monitoring-view ClusterRole allows read access to:
#   - User Workload Monitoring Prometheus (thanos-querier)
#   - Platform Prometheus (read-only)
#
# Ref: https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/monitoring/enabling-monitoring-for-user-defined-projects
# ============================================================================
apiVersion: v1
kind: ServiceAccount
metadata:
  name: grafana-sa
  namespace: private-ai
  labels:
    app: grafana
    app.kubernetes.io/part-of: step-07-model-performance-metrics
  annotations:
    argocd.argoproj.io/sync-wave: "1"
---
# ClusterRoleBinding to allow Grafana to read metrics from Thanos Querier
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: grafana-cluster-monitoring-view
  labels:
    app: grafana
    app.kubernetes.io/part-of: step-07-model-performance-metrics
  annotations:
    argocd.argoproj.io/sync-wave: "1"
subjects:
  - kind: ServiceAccount
    name: grafana-sa
    namespace: private-ai
roleRef:
  kind: ClusterRole
  name: cluster-monitoring-view
  apiGroup: rbac.authorization.k8s.io

