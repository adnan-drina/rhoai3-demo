apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Step 03: Private AI - GPU as a Service (GPUaaS)
# Implements dynamic GPU allocation using Kueue integration
# with proper user authentication and RBAC
#
# Architecture:
#   Users → Auth → Project RBAC → LocalQueue → ClusterQueue → GPU Nodes
#
# Ref: https://docs.redhat.com/en/documentation/red_hat_openshift_ai_self-managed/3.0/

resources:
  # ═══════════════════════════════════════════════════════════════════════════
  # 1. Authentication (sync-wave: 0-2)
  # ═══════════════════════════════════════════════════════════════════════════
  # HTPasswd secret for demo users
  - auth/htpasswd-secret.yaml
  # OAuth identity provider configuration
  - auth/oauth.yaml
  # NOTE: OpenShift Groups (auth/groups.yaml) are created via deploy.sh
  # because ArgoCD cannot parse user.openshift.io/v1 Group schema
  
  # ═══════════════════════════════════════════════════════════════════════════
  # 2. Namespace (sync-wave: 3)
  # ═══════════════════════════════════════════════════════════════════════════
  - namespace.yaml
  
  # ═══════════════════════════════════════════════════════════════════════════
  # 3. Kueue Resources (sync-wave: 4-5)
  # ═══════════════════════════════════════════════════════════════════════════
  # ResourceFlavors - Define GPU node types
  - resource-flavors.yaml
  # ClusterQueue - Cluster-wide quota pool
  - cluster-queue.yaml
  # LocalQueue - Project entry point
  - local-queue.yaml
  
  # ═══════════════════════════════════════════════════════════════════════════
  # 4. Project RBAC (sync-wave: 5)
  # ═══════════════════════════════════════════════════════════════════════════
  # ai-admin as project admin
  - rbac/project-admin.yaml
  # ai-developer as project editor
  - rbac/project-editor.yaml
  
  # ═══════════════════════════════════════════════════════════════════════════
  # 5. Kueue Admin Access (sync-wave: 10)
  # ═══════════════════════════════════════════════════════════════════════════
  # Grant rhoai-admins ClusterRole for Distributed Workloads dashboard
  - rbac/kueue-admin-access.yaml

# NOTE: Hardware Profiles are GLOBAL (in redhat-ods-applications)
# They reference localQueueName: "default" which must exist in each project.
# The LocalQueue named "default" is created above in local-queue.yaml.
# See step-02-rhoai for Hardware Profile definitions.
